# YOLO-PCB GUI 專案規格文件

## 1. 專案概述

### 1.1 專案名稱
YOLO-PCB GUI - 基於深度學習的PCB缺陷檢測圖形化界面系統

### 1.2 專案目標
為PCB（印刷電路板）缺陷檢測提供一個功能完整、易於使用的圖形化界面，支援模型訓練、檢測和測試三大核心功能。

### 1.3 專案範圍
- 提供基於YOLO算法的PCB缺陷檢測GUI界面
- 支援多種輸入來源（圖片、影片、資料夾、攝像頭）
- 提供完整的模型訓練流程管理
- 包含模型性能測試與評估功能
- 支援結果可視化與匯出

### 1.4 目標用戶
- PCB製造商的品質控制人員
- 機器視覺工程師
- 深度學習研究人員
- 自動化檢測系統開發者

## 2. 功能需求

### 2.1 核心功能模組

#### 2.1.1 檢測功能 (Detection)
- **輸入來源支援**
  - 單張圖片檢測
  - 影片檔案檢測
  - 資料夾批次檢測
  - 即時攝像頭檢測
- **檢測參數配置**
  - 信心度閾值設定 (confidence threshold)
  - IoU閾值調整
  - 最大檢測數量限制
  - 圖像尺寸設定
- **結果顯示與輸出**
  - 即時檢測結果標註
  - 檢測統計資訊
  - 結果圖像保存
  - 檢測日誌記錄

#### 2.1.2 訓練功能 (Training)
- **資料配置**
  - 訓練集路徑設定
  - 驗證集路徑設定
  - 類別標籤管理
  - 資料增強參數
- **模型配置**
  - YOLO模型架構選擇
  - 預訓練權重載入
  - 模型輸出路徑設定
- **超參數配置**
  - 訓練輪數 (epochs)
  - 批次大小 (batch size)
  - 學習率 (learning rate)
  - 優化器選擇
- **訓練監控**
  - 即時損失函數顯示
  - 訓練進度追蹤
  - 驗證指標監控

#### 2.1.3 測試功能 (Testing)
- **測試配置**
  - 測試資料集設定
  - 模型權重載入
  - 測試參數配置
- **性能評估**
  - mAP (mean Average Precision) 計算
  - 精確度與召回率統計
  - 混淆矩陣生成
- **結果分析**
  - 詳細測試報告
  - 性能圖表生成
  - 結果匯出功能

### 2.2 輔助功能

#### 2.2.1 配置管理
- 應用程式設定保存與載入
- 用戶偏好設定管理
- 模型與檢測參數快速切換

#### 2.2.2 圖像處理與顯示
- 多格式圖像支援
- 圖像縮放與平移
- 檢測結果標註顯示
- 標註開關控制

#### 2.2.3 日誌與監控
- 操作日誌記錄
- 錯誤訊息追蹤
- 系統資源監控

## 3. 非功能性需求

### 3.1 性能要求
- **響應時間**
  - 單張圖片檢測: < 2秒
  - GUI操作響應: < 100ms
  - 模型載入時間: < 10秒
- **記憶體使用**
  - 基礎GUI運行: < 500MB
  - 模型載入後: < 2GB (CPU模式)
  - GPU模式: 視GPU記憶體而定
- **CPU使用率**
  - 閒置狀態: < 5%
  - 檢測運行: < 80%

### 3.2 系統相容性
- **作業系統支援**
  - Windows 10/11 (主要支援)
  - Linux (Ubuntu 18.04+)
  - macOS 10.15+ (基本支援)
- **Python版本**
  - Python 3.7 - 3.10
- **硬體需求**
  - 最低記憶體: 4GB RAM
  - 推薦記憶體: 8GB+ RAM
  - GPU支援: CUDA-capable GPU (可選)

### 3.3 可用性要求
- **界面設計**
  - 直觀的操作流程
  - 中英文界面支援
  - 一致的視覺設計語言
- **錯誤處理**
  - 友善的錯誤訊息
  - 自動錯誤恢復機制
  - 詳細的故障排除指南

### 3.4 可維護性
- 模組化程式架構
- 完整的程式文檔
- 單元測試覆蓋
- 版本控制與發布管理

## 4. 系統架構

### 4.1 整體架構

```
YOLO-PCB-GUI/
├── 前端界面層 (GUI Layer)
│   ├── 主視窗 (MainWindow)
│   ├── 檢測頁籤 (DetectTab)
│   ├── 訓練頁籤 (TrainTab)
│   └── 測試頁籤 (TestTab)
├── 業務邏輯層 (Core Layer)
│   ├── 檢測器 (Detector)
│   ├── 訓練器 (Trainer)
│   └── 測試器 (Tester)
├── 資料層 (Data Layer)
│   ├── 配置管理 (ConfigManager)
│   ├── 資料載入器 (DataLoader)
│   └── 結果儲存 (ResultSaver)
└── 底層框架 (Framework Layer)
    ├── PyQt5 (GUI框架)
    ├── PyTorch (深度學習)
    └── OpenCV (圖像處理)
```

### 4.2 核心模組職責

#### 4.2.1 GUI模組 (`gui/`)
- **main_window.py**: 主視窗管理、選單系統、狀態列
- **detect_tab.py**: 檢測界面、參數控制、結果顯示
- **train_tab.py**: 訓練界面、配置管理、進度監控
- **test_tab.py**: 測試界面、報告顯示、結果分析
- **widgets/image_viewer.py**: 圖像顯示、縮放平移、標註繪製

#### 4.2.2 核心模組 (`core/`)
- **detector.py**: 檢測邏輯、模型推理、結果處理
- **trainer.py**: 訓練流程、參數管理、進度回報
- **tester.py**: 測試執行、指標計算、報告生成

#### 4.2.3 工具模組 (`yolo_gui_utils/`)
- **config_manager.py**: 配置檔案管理、設定持久化
- **simple_yolo_loader_v2.py**: YOLO模型載入器
- **yolo_loader.py**: 進階模型載入功能

### 4.3 資料流設計

#### 4.3.1 檢測流程
```
用戶輸入 → 參數配置 → 模型載入 → 圖像處理 → 推理計算 → 結果顯示 → 保存輸出
```

#### 4.3.2 訓練流程
```
資料配置 → 模型初始化 → 超參數設定 → 訓練執行 → 進度監控 → 模型保存
```

#### 4.3.3 測試流程
```
測試配置 → 模型載入 → 資料載入 → 批次測試 → 指標計算 → 報告生成
```

### 4.4 多執行緒設計
- **主執行緒**: GUI渲染與事件處理
- **檢測執行緒**: 模型推理與圖像處理
- **訓練執行緒**: 模型訓練執行
- **測試執行緒**: 批次測試執行

## 5. 界面設計

### 5.1 主視窗布局
- **選單列**: 檔案、編輯、檢視、工具、幫助
- **工具列**: 常用功能快捷按鈕
- **主工作區**: 頁籤式界面
- **狀態列**: 狀態資訊、進度顯示

### 5.2 頁籤設計

#### 5.2.1 檢測頁籤
- **左側面板**: 參數配置、模型設定
- **中央區域**: 圖像顯示、結果標註
- **右側面板**: 檢測統計、操作控制

#### 5.2.2 訓練頁籤
- **多分頁設計**:
  - 資料配置頁
  - 模型配置頁
  - 超參數配置頁
  - 訓練控制頁
  - 結果監控頁

#### 5.2.3 測試頁籤
- **多分頁設計**:
  - 測試配置頁
  - 測試控制頁
  - 結果顯示頁
  - 報告匯出頁

### 5.3 控制元件設計
- **檔案選擇**: 支援拖放、瀏覽選擇
- **參數調整**: 滑桿、數值輸入、下拉選單
- **進度顯示**: 進度條、百分比、剩餘時間
- **結果顯示**: 表格、圖表、圖像標註

## 6. 資料模型

### 6.1 設定檔格式

#### 6.1.1 主配置檔 (`config.json`)
```json
{
  "app": {
    "name": "YOLO-PCB GUI",
    "version": "1.0.0",
    "window_geometry": [100, 100, 1200, 800],
    "theme": "default",
    "language": "zh-TW"
  },
  "detection": {
    "confidence_threshold": 0.7,
    "iou_threshold": 0.45,
    "image_size": 640,
    "device": "auto",
    "save_results": true
  },
  "training": {
    "epochs": 100,
    "batch_size": 16,
    "learning_rate": 0.01,
    "image_size": 608
  },
  "testing": {
    "batch_size": 32,
    "confidence_threshold": 0.001,
    "iou_threshold": 0.6
  }
}
```

#### 6.1.2 資料配置檔 (`data/*.yaml`)
```yaml
train: path/to/train/images
val: path/to/val/images
test: path/to/test/images

nc: 6  # number of classes
names: ['missing_hole', 'mouse_bite', 'open_circuit', 'short', 'spur', 'spurious_copper']
```

### 6.2 檢測結果格式
```json
{
  "image_path": "path/to/image.jpg",
  "detections": [
    {
      "class_id": 0,
      "class_name": "missing_hole",
      "confidence": 0.85,
      "bbox": [x1, y1, x2, y2]
    }
  ],
  "inference_time": 0.123,
  "image_size": [640, 640]
}
```

### 6.3 訓練結果格式
```json
{
  "epoch": 100,
  "train_loss": 0.0234,
  "val_loss": 0.0456,
  "mAP_0.5": 0.892,
  "mAP_0.5:0.95": 0.654,
  "best_weights": "path/to/best.pt",
  "last_weights": "path/to/last.pt"
}
```

## 7. 部署與安裝

### 7.1 環境要求
```
- Python 3.7+
- Windows 10/11, Linux (Ubuntu 18.04+), or macOS 10.15+
- 4GB+ RAM (推薦 8GB+)
- CUDA-capable GPU (可選，用於加速)
```

### 7.2 安裝步驟

#### 7.2.1 使用pip安裝
```bash
# 克隆專案
git clone https://github.com/username/YOLO-PCB-GUI.git
cd YOLO-PCB-GUI

# 建立虛擬環境
python -m venv venv
source venv/bin/activate  # Linux/macOS
# 或
venv\Scripts\activate     # Windows

# 安裝依賴
pip install -r requirements_gui.txt
```

#### 7.2.2 啟動應用程式
```bash
# 方式一：使用啟動腳本
python run_gui.py

# 方式二：直接執行主程式
python main.py
```

### 7.3 依賴清單
```txt
PyQt5>=5.15.2           # GUI框架
torch>=1.12.0           # 深度學習框架
torchvision>=0.13.0     # 視覺處理
opencv-python>=4.5.0    # 圖像處理
numpy>=1.21.0          # 數值計算
pandas>=1.3.0          # 資料處理
matplotlib>=3.5.0      # 圖表繪製
PyYAML>=6.0            # 配置檔案
tqdm>=4.62.0           # 進度條
ultralytics>=8.0.0     # YOLO工具
```

### 7.4 打包部署

#### 7.4.1 使用PyInstaller
```bash
pip install pyinstaller
pyinstaller --onefile --windowed main.py
```

#### 7.4.2 使用cx_Freeze
```bash
pip install cx_Freeze
python setup.py build
```

## 8. 測試與驗證

### 8.1 測試策略

#### 8.1.1 單元測試
- 核心功能模組測試
- 配置管理測試
- 資料處理測試

#### 8.1.2 整合測試
- GUI與核心模組整合
- 多執行緒通信測試
- 檔案I/O操作測試

#### 8.1.3 系統測試
- 完整工作流程測試
- 性能基準測試
- 相容性測試

### 8.2 測試工具
```python
# 測試框架
pytest>=6.2.0
pytest-qt>=4.0.0

# 程式碼覆蓋率
coverage>=5.5
pytest-cov>=2.12.0

# 模擬與fixture
pytest-mock>=3.6.0
```

### 8.3 驗證指標
- **功能正確性**: 檢測準確率、訓練收斂性
- **性能指標**: 響應時間、記憶體使用、CPU利用率
- **穩定性**: 長時間運行測試、異常處理測試
- **可用性**: 用戶體驗測試、操作流暢性

## 9. 未來增強功能

### 9.1 短期規劃 (3-6個月)
- **模型管理**: 模型版本控制、性能比較
- **批次處理**: 大規模資料集處理優化
- **結果分析**: 進階統計分析、趨勢圖表
- **用戶體驗**: 主題自訂、快捷鍵支援

### 9.2 中期規劃 (6-12個月)
- **多模型支援**: YOLOv8、其他檢測算法整合
- **雲端整合**: 模型雲端訓練、結果同步
- **API介面**: RESTful API、命令列工具
- **多語言支援**: 國際化與本地化

### 9.3 長期規劃 (1-2年)
- **AI輔助**: 智能參數調優、自動標註
- **邊緣計算**: 嵌入式設備部署支援
- **協作功能**: 多用戶協作、權限管理
- **產業整合**: ERP系統對接、生產線整合

## 10. 風險評估與應對

### 10.1 技術風險
- **相依性風險**: 第三方套件版本衝突
  - 應對: 嚴格版本管理、定期更新測試
- **性能風險**: 大檔案處理記憶體不足
  - 應對: 分批處理、記憶體優化

### 10.2 產品風險
- **用戶接受度**: 學習曲線過陡
  - 應對: 完善文檔、教學影片
- **競爭風險**: 同類產品競爭
  - 應對: 持續創新、差異化功能

### 10.3 維護風險
- **程式碼維護**: 技術債務累積
  - 應對: 定期重構、程式碼審查
- **人員風險**: 關鍵開發人員流失
  - 應對: 知識文件化、團隊技能培養
